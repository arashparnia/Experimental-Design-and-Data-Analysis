---
output:
  pdf_document: default
  html_document: default
---
always_allow_html: yes
---
title: "Final Assignment"
output:
  word_document: default
  html_notebook: default
  pdf_document: default
  html_document: default
---
# how does martial status effect hotels choices
Importing data from original databse
consumer class variable is created from the variablessrchadultscountand srchchildrencount. Consumers with asrchadultcountof 1 and 2 would be transformed to “sin-gle person” and “couples” respectively. Consumers with a srchchildrencount greater than 1 wouldbe called ”parents”. All other consumers are called ”others
 

loading and saving
```{r}




load(file = "../Data/mydata.RData")
# save(mydata,file = "../Data/mydata.RData")
mydata <- data
remove(data)
```

trim database
```{r}
# mydata <- subset(mydata, select = -c(prop_brand_bool) )
# mydata <- subset(mydata, select = -c(position) )
# mydata <- subset(mydata, select = -c(srch_saturday_night_bool) )
# mydata <- subset(mydata, select = -c(random_bool) )
# mydata <- subset(mydata, select = -c(price_usd_normalized) )
# mydata <- subset(mydata, select = -c(Pclass) )
# mydata <- subset(mydata, select = -c(score) )

```

subsetting
```{r}
mydata <- mydata[which(mydata$click_bool ==  1),]
mydata <- mydata[which(mydata$prop_review_score !=  0),]
mydata <- mydata[which(mydata$srch_id < 4000),]
# mydata <- head(mydata,1000)
length(((mydata$srch_id)))
length((unique(mydata$srch_id)))
```
how many uniqe search ids

pairs plot
```{r}
df <- subset(head(mydata,50), select = -c(consumer))
pairs(df)
```

```{r}
qqnorm(mydata$price_usd)
shapiro.test(mydata$price_usd)
```
not normally disterbuted 

```{r}
library(outliers)
chisq.out.test(mydata$price_usd, variance = var(mydata$price_usd),opposite = TRUE)
chisq.out.test(mydata$price_usd, variance = var(mydata$price_usd),opposite = FALSE)
```

removing outliers
```{r}
mydata <- mydata[which(mydata$price_usd < 1242 ),] 
chisq.out.test(mydata$price_usd, variance = var(mydata$price_usd),opposite = TRUE)
chisq.out.test(mydata$price_usd, variance = var(mydata$price_usd),opposite = FALSE)
```

```{r}
# library(plotly)
# library(ggplot2)
# plot_ly(x = mydata$price_usd, type = "histogram")
# ggplotly(p)
# ggplotly(p)

```

```{r}

par(mfrow=c(3,2));
qqnorm(mydata$price_usd,main="price_usd")
qqnorm(mydata$prop_starrating,main="prop_starrating")
qqnorm(mydata$prop_review_score,main="prop_review_score")
qqnorm(mydata$prop_location_score1,main="prop_location_score1")
qqnorm(mydata$prop_location_score2,main="prop_location_score2")
```
```{r}
par(mfrow=c(3,2));
hist(mydata$price_usd,main="price_usd")
hist(mydata$prop_starrating,main="prop_starrating")
hist(mydata$prop_review_score,main="prop_review_score")
hist(mydata$prop_location_score1,main="prop_location_score1")
hist(mydata$prop_location_score2,main="prop_location_score2")
```
```{r}

```

```{r}
df <- subset(mydata, select = -c(consumer,click_bool,srch_id,site_id,prop_id))
round(cor(df),3)
```
                    prop_starrating prop_review_score prop_location_score1 prop_location_score2 price_usd promotion_flag booking_bool
prop_starrating                 1.00              0.31                 0.30                 0.05      0.47           0.19         0.00
prop_review_score               0.31              1.00                 0.15                 0.04      0.22           0.06         0.12
prop_location_score1            0.30              0.15                 1.00                 0.29      0.27           0.16         0.00
prop_location_score2            0.05              0.04                 0.29                 1.00      0.02           0.03         0.11
price_usd                       0.47              0.22                 0.27                 0.02      1.00          -0.01        -0.11
promotion_flag                  0.19              0.06                 0.16                 0.03     -0.01           1.00         0.11
booking_bool                    0.00              0.12                 0.00                 0.11     -0.11           0.11         1.00

with 0.47 prop_starrating  has the highest colinearity with price_usd followed by  0.31 for prop_starrating and prop_review_score 


```{r}

```
randomized block design
```{r}
xtabs(price_usd ~ prop_starrating + consumer ,data=mydata)
xtabs(price_usd ~ prop_starrating + prop_review_score ,data=mydata)
```

```{r}
attach(mydata)
# par(mfrow=c(3,3))
boxplot(price_usd~prop_starrating); boxplot(price_usd~consumer) ; boxplot(price_usd~prop_review_score) 

interaction.plot(prop_starrating,consumer,price_usd); interaction.plot(consumer,prop_starrating,price_usd) ; interaction.plot(prop_review_score,prop_starrating,price_usd) 
```

```{r}
mydata$prop_starrating=factor(mydata$prop_starrating)
mydata$prop_review_score=factor(mydata$prop_review_score)

aovpen=lm(price_usd~prop_starrating+prop_review_score,data=mydata)

anova(aovpen)
summary(aovpen)
drop1(aovpen,test="Chisq")
qqnorm(residuals(aovpen))
plot(fitted(aovpen),residuals(aovpen))

```

prop_starrating is more significant than consumer type and prop_review_score but also both significant 


#Logistic Regression
An experiment with:
an outcome Y that is 0 or 1 (“binary dependent variable”);
one or more numerical explanatory variables X1,...,Xp.
one or more factor explanatory variables. (“independent variable”).
The purpose is to explain Y by a function of X.

```{r}
# tot=xtabs(~prop_review_score+price_usd,data=mydata); 
# hist(mydata$price_usd,main="price_usd");
# round(xtabs(booking_bool~prop_review_score+price_usd,data=mydata)/tot,2)
# 
# totage=xtabs(~prop_review_score,data=mydata)
# barplot(xtabs(booking_bool~prop_review_score,data=mydata)/totage)
# 
# mydata$prop_review_score2 <- mydata$prop_review_score^2
# myglm=glm(booking_bool~prop_review_score+prop_review_score2+price_usd,data=mydata,family=binomial)
# summary(myglm)
 
 
```
```{r}
myglm=glm(booking_bool~
                         prop_starrating
          +prop_review_score
            +prop_location_score1
            +prop_location_score2
            +price_usd
            +promotion_flag
            +consumer
            ,data=mydata,family=binomial)
summary(myglm)
drop1(myglm,test="Chisq")
```

```{r}
myglm=glm(booking_bool~
            prop_review_score
            +prop_location_score1
            +prop_location_score2
            +price_usd
            +promotion_flag
            +consumer
            ,data=mydata,family=binomial)
summary(myglm)
drop1(myglm,test="Chisq")
```
```{r}
mydata$consumer=factor(mydata$consumer)
mydata$prop_review_score=factor(mydata$prop_review_score)
myglm=glm(booking_bool~
            prop_review_score
            +prop_location_score2
            +price_usd
            +promotion_flag
            +consumer
            ,data=mydata,family=binomial)
summary(myglm)
drop1(myglm,test="Chisq")
```
```{r}

plot(c(0,coef(myglm)[2:9]),type="l",main = "coefficients for prop reviews 1 to 5 with 0.5 steps" )
```
```{r}
drop1(myglm,test="Chisq")
```

